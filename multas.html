<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MULTAs v2.1 - åŒ»å­¦å®Ÿç¿’ãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ï¼ˆAIåˆ†é¡å¯¾å¿œï¼‰</title>
    <style>
        /* === ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Yu Gothic UI', sans-serif;
            background: linear-gradient(135deg, #81c784 0%, #b39ddb 100%);
            height: 100vh;
            color: #333;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
        }

        /* === ãƒ˜ãƒƒãƒ€ãƒ¼ === */
        .header {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            text-align: center;
            color: white;
            flex-shrink: 0;
            position: relative;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        /* === æ—¥ä»˜é¸æŠ === */
        .day-selector {
            position: absolute;
            top: 15px;
            right: 20px;
        }

        .day-display {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px 16px;
            background: #7e57c2;
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(126, 87, 194, 0.3);
        }

        .day-display:hover {
            background: #673ab7;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(126, 87, 194, 0.4);
        }

        .day-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 5px;
            background: rgba(0, 0, 0, 0.85);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            overflow: hidden;
            display: none;
            white-space: nowrap;
        }

        .day-dropdown.active {
            display: flex;
            flex-direction: row;
            gap: 2px;
            padding: 8px;
        }

        .day-option {
            padding: 6px 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 0.85rem;
            color: white;
            border-radius: 4px;
        }

        .day-option:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .day-option.selected {
            background: #7e57c2;
            color: white;
        }

        /* === ãƒ¢ãƒ‹ã‚¿ãƒ¼åˆ‡ã‚Šæ›¿ãˆã‚¿ãƒ– === */
        .monitor-tabs {
            display: flex;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            flex-shrink: 0;
            justify-content: center;
        }

        .monitor-tab {
            padding: 10px 24px;
            border: 2px solid #4a9eff;
            background: white;
            color: #4a9eff;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 25px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: 140px;
            text-align: center;
        }

        .monitor-tab:hover {
            background: #e8f2ff;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(74, 158, 255, 0.2);
        }

        .monitor-tab.active {
            background: #66bb6a;
            color: white;
            border-color: #66bb6a;
            box-shadow: 0 4px 12px rgba(102, 187, 106, 0.3);
        }

        /* === ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ === */
        .main-content {
            flex: 1;
            padding: 0;
            background: white;
            display: flex;
            flex-direction: column;
            min-height: 0;
            overflow: hidden;
        }

        /* === çµ±è¨ˆå›ºå®šã‚¨ãƒªã‚¢ === */
        .monitor-stats {
            background: white;
            padding: 12px 20px 8px;
            border-bottom: 1px solid #f0f0f0;
            flex-shrink: 0;
        }

        /* === ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ === */
        .monitor-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px 20px;
            min-height: 0;
        }

        /* === ãƒ¢ãƒ‹ã‚¿ãƒ¼è¡¨ç¤º === */
        .monitor {
            display: none;
            height: 100%;
            flex-direction: column;
        }

        .monitor.active {
            display: flex;
        }

        .monitor h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.1rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 6px;
            margin: 0 0 15px 0;
        }

        /* === çµ±è¨ˆã‚«ãƒ¼ãƒ‰ === */
        .stats-grid {
            display: flex;
            gap: 6px;
            margin-bottom: 0;
            align-items: center;
        }

        .exp-bar-container {
            flex: 1;
            height: 30px;
            background: rgba(0,0,0,0.1);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            margin-left: 10px;
        }

        .exp-bar {
            height: 100%;
            background: linear-gradient(90deg, #b39ddb 0%, #9575cd 100%);
            border-radius: 15px;
            transition: width 0.5s ease;
            box-shadow: 0 2px 4px rgba(179, 157, 219, 0.3);
        }

        .exp-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #333;
            font-weight: 600;
            font-size: 0.8rem;
            text-shadow: 0 0 2px rgba(255,255,255,0.8);
        }

        .stat-card {
            background: rgba(179, 157, 219, 0.08);
            border-radius: 5px;
            padding: 4px 8px;
            text-align: center;
            border: 1px solid rgba(179, 157, 219, 0.12);
            flex: 1;
            min-width: 60px;
            max-width: 80px;
        }

        .stat-number {
            font-size: 0.85rem;
            font-weight: bold;
            color: #7e57c2;
            margin-bottom: 1px;
        }

        .stat-label {
            color: #999;
            font-size: 0.65rem;
            line-height: 1.1;
        }

        /* === è¨˜éŒ²ã‚¢ã‚¤ãƒ†ãƒ  === */
        .record-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .record-item:hover {
            transform: translateX(3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-left-color: #5a67d8;
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .record-timestamp {
            color: #666;
            font-size: 0.8rem;
        }

        .record-actions {
            display: flex;
            gap: 6px;
        }

        .record-btn {
            padding: 6px 10px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .record-btn:hover {
            background: #f5f5f5;
            border-color: #999;
            transform: translateY(-1px);
        }

        .edit-btn {
            color: #555;
        }

        .delete-btn {
            color: #666;
        }

        .save-btn {
            background: #4a9eff;
            color: white;
            border-color: #4a9eff;
        }

        .save-btn:hover {
            background: #357abd;
            border-color: #357abd;
        }

        .cancel-btn {
            color: #888;
        }

        .record-text {
            margin-bottom: 14px;
            line-height: 1.8;
            font-size: 1.2rem;
            color: #333;
            font-weight: 500;
            word-wrap: break-word;
            letter-spacing: 0.02em;
        }

        .record-category {
            display: inline-block;
            padding: 5px 10px;
            background: #e3f2fd;
            color: #1976d2;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .record-ai-indicator {
            display: inline-block;
            margin-left: 8px;
            padding: 3px 7px;
            background: #4caf50;
            color: white;
            border-radius: 10px;
            font-size: 0.75rem;
        }

        /* === ã‚«ãƒ†ã‚´ãƒªåˆ¥è¡¨ç¤º === */
        .category-section {
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            background: #f8f9fa;
        }

        .category-header {
            padding: 12px 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .category-content {
            padding: 15px;
        }

        .category-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 3px solid #667eea;
        }

        .category-item .category-text {
            font-size: 1.15rem;
            line-height: 1.8;
            color: #333;
            font-weight: 500;
            word-wrap: break-word;
            letter-spacing: 0.02em;
        }

        /* === ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º === */
        .report-content {
            background: white;
            border-radius: 10px;
            padding: 20px;
            line-height: 1.6;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .report-section {
            margin-bottom: 20px;
        }

        .report-section h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 4px;
        }

        /* === çµ±è¨ˆè¡¨ç¤º === */
        .stats-display {
            display: block;
        }

        .stats-display.hidden {
            display: none;
        }

        .report-actions {
            display: flex;
            gap: 8px;
            margin: 0;
        }

        .btn-secondary {
            flex: 1;
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-secondary:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        }

        .btn-advance,
        .btn-previous {
            background: #90EE90;
            color: #2d5a2d;
        }

        .btn-advance:hover,
        .btn-previous:hover {
            background: #7dd87d;
        }


        /* === ãƒœãƒˆãƒ å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  === */
        .bottom-input {
            background: white;
            border-top: 1px solid #e0e0e0;
            padding: 15px 20px 20px;
            flex-shrink: 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            position: relative;
            z-index: 10;
        }

        .input-row {
            display: flex;
            gap: 10px;
            align-items: flex-end;
            margin-bottom: 10px;
        }

        .experience-input {
            flex: 1;
        }

        .input-row label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.85rem;
            font-weight: 600;
            color: #555;
        }

        .input-row input,
        .input-row textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .input-row input:focus,
        .input-row textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-row textarea {
            resize: none;
            height: 60px;
            min-height: 60px;
            max-height: 120px;
            padding-right: 60px;
        }

        .submit-btn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 45px;
            height: 45px;
            background: #b39ddb;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(179, 157, 219, 0.4);
            z-index: 10;
        }

        .submit-btn svg {
            width: 24px;
            height: 24px;
            transform: rotate(-10deg);
        }

        .submit-btn:hover {
            background: #9575cd;
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(179, 157, 219, 0.6);
        }

        .submit-btn:active {
            transform: scale(0.95);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* === ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º === */
        .status-message {
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #b8daff;
        }

        /* === ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° === */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* === ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ === */
        .edit-mode {
            background: #fff3cd;
            border: 2px solid #ffc107;
        }

        .edit-textarea {
            width: 100%;
            min-height: 80px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.9rem;
            resize: vertical;
        }

        .edit-actions {
            margin-top: 8px;
            display: flex;
            gap: 8px;
        }

        .save-btn {
            background: #28a745;
            color: white;
        }

        .cancel-btn {
            background: #6c757d;
            color: white;
        }

        /* === ç©ºçŠ¶æ…‹è¡¨ç¤º === */
        .empty-state {
            text-align: center;
            color: #666;
            padding: 40px 20px;
            line-height: 1.6;
        }

        .empty-state .icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* === ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´ === */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .header p {
                font-size: 0.8rem;
            }

            .monitor-tab {
                font-size: 0.8rem;
                padding: 10px 6px;
            }

            .monitor h3 {
                font-size: 1rem;
                margin-bottom: 12px;
            }

            .bottom-input {
                padding: 12px 15px 15px;
            }

            .input-row {
                flex-direction: column;
                gap: 5px;
            }


            .stats-grid {
                gap: 4px;
                margin-bottom: 0;
            }

            .stat-card {
                padding: 3px 6px;
                min-width: 55px;
                max-width: 70px;
            }

            .stat-number {
                font-size: 0.75rem;
                color: #7e57c2;
            }

            .stat-label {
                font-size: 0.6rem;
                color: #aaa;
            }

            .report-actions {
                gap: 6px;
            }

            .record-text {
                font-size: 1.1rem;
                line-height: 1.7;
                letter-spacing: 0.01em;
            }

            .category-item .category-text {
                font-size: 1.05rem;
                line-height: 1.7;
                letter-spacing: 0.01em;
            }

            .monitor-stats {
                padding: 8px 15px 6px;
            }

            .monitor-content {
                padding: 12px 15px;
            }

            .monitor h3 {
                font-size: 1rem;
                margin-bottom: 12px;
            }

            .btn-secondary {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
        }

        /* === ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œå¯¾å¿œ === */
        .input-row textarea {
            transition: height 0.3s ease;
        }

        .input-row textarea:focus {
            height: 80px;
        }
    </style>
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header">
        <h1>MULTAs</h1>
        <p>Medical University Learning and Training Assessment system</p>
        <!-- æ—¥ä»˜é¸æŠ -->
        <div class="day-selector">
            <div class="day-display" onclick="toggleDayDropdown()">
                <span id="currentDayLabel">1æ—¥ç›®</span>
                <span style="font-size: 0.7em;">â–¼</span>
            </div>
            <div class="day-dropdown" id="dayDropdown">
                <div class="day-option" onclick="selectDay('practice')">ç·´ç¿’</div>
                <div class="day-option selected" onclick="selectDay(1)">1æ—¥</div>
                <div class="day-option" onclick="selectDay(2)">2æ—¥</div>
                <div class="day-option" onclick="selectDay(3)">3æ—¥</div>
                <div class="day-option" onclick="selectDay(4)">4æ—¥</div>
                <div class="day-option" onclick="selectDay(5)">5æ—¥</div>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ‹ã‚¿ãƒ¼åˆ‡ã‚Šæ›¿ãˆã‚¿ãƒ– -->
    <div class="monitor-tabs">
        <button class="monitor-tab active" onclick="switchMonitor('monitor1')">
            LOG
        </button>
        <button class="monitor-tab" onclick="switchMonitor('monitor2')">
            LIST
        </button>
        <button class="monitor-tab" onclick="switchMonitor('monitor3')">
            REPORT
        </button>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="main-content">
        
        <!-- çµ±è¨ˆå›ºå®šã‚¨ãƒªã‚¢ -->
        <div class="monitor-stats">
            <!-- ãƒ¢ãƒ‹ã‚¿ãƒ¼1ç”¨çµ±è¨ˆ -->
            <div id="stats-monitor1" class="stats-display">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="recordCount">0</div>
                        <div class="stat-label">è¨˜éŒ²å›æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="userLevel">1</div>
                        <div class="stat-label">LV</div>
                    </div>
                    <div class="exp-bar-container">
                        <div class="exp-bar" id="expBar" style="width: 0%;"></div>
                    </div>
                </div>
            </div>

            <!-- ãƒ¢ãƒ‹ã‚¿ãƒ¼2ç”¨çµ±è¨ˆ -->
            <div id="stats-monitor2" class="stats-display" style="display: none;">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="recordCount2">0</div>
                        <div class="stat-label">è¨˜éŒ²å›æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="userLevel2">1</div>
                        <div class="stat-label">LV</div>
                    </div>
                    <div class="exp-bar-container">
                        <div class="exp-bar" id="expBar2" style="width: 0%;"></div>
                    </div>
                </div>
            </div>

            <!-- ãƒ¢ãƒ‹ã‚¿ãƒ¼3ç”¨çµ±è¨ˆ -->
            <div id="stats-monitor3" class="stats-display" style="display: none;">
                <div class="report-actions">
                    <button class="btn-secondary" onclick="generateDailyReport()">
                        ğŸ¤– ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
                    </button>
                </div>
            </div>
        </div>

        <!-- ãƒ¢ãƒ‹ã‚¿ãƒ¼1: ãƒ­ã‚°ä¿å­˜ -->
        <div id="monitor1" class="monitor active">
            <div class="monitor-content">
                <div id="recordsList">
                    <div class="empty-state">
                        <div class="icon">ğŸ“</div>
                        <p>ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“<br>ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰æœ€åˆã®è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒ¢ãƒ‹ã‚¿ãƒ¼2: ä½“é¨“æ•´ç† -->
        <div id="monitor2" class="monitor">
            <div class="monitor-content">
                <div id="organizedView">
                    <div class="empty-state">
                        <div class="icon">ğŸ¤–</div>
                        <p>è¨˜éŒ²ã‚’è¿½åŠ ã™ã‚‹ã¨<br>AIåˆ†æã«ã‚ˆã‚‹12æ™‚è¨ˆåˆ†é¡ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒ¢ãƒ‹ã‚¿ãƒ¼3: Dailyãƒ¬ãƒãƒ¼ãƒˆ -->
        <div id="monitor3" class="monitor">
            <div class="monitor-content">
                <div id="dailyReport">
                    <div class="report-content">
                        <h4>ğŸ“‹ æœ¬æ—¥ã®å®Ÿç¿’ãƒ¬ãƒãƒ¼ãƒˆ</h4>
                        <div class="empty-state">
                            <div class="icon">ğŸ“Š</div>
                            <p>è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ã‹ã‚‰<br>ã€Œãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨<br>ãã®æ—¥ã®ä½“é¨“ã‚’ã¾ã¨ã‚ãŸãƒ¬ãƒãƒ¼ãƒˆãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒœãƒˆãƒ å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="bottom-input">
        <div class="input-row">
            <div class="experience-input" style="position: relative;">
                <textarea id="experienceText" placeholder="å®Ÿç¿’ã§ä½“é¨“ã—ãŸã“ã¨ã‚’è¨˜éŒ²â€¦ â€»æ‚£è€…ã®å€‹äººæƒ…å ±ã¯å…¥åŠ›ã—ãªã„"></textarea>
                <button type="button" class="submit-btn" onclick="submitExperience()" title="é€ä¿¡">
                    <span id="submitText">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2 21L23 12L2 3V10L17 12L2 14V21Z" fill="white"/>
                        </svg>
                    </span>
                    <span id="submitLoading" style="display: none;">
                        <span class="loading"></span>
                    </span>
                </button>
            </div>
        </div>

        <div id="statusMessage"></div>
    </div>

    <script>
        // === ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° ===
        let records = [];
        let recordIdCounter = 0;
        let currentMonitor = 'monitor1';
        let currentDay = 1;  // ç¾åœ¨ã®æ—¥ä»˜ï¼ˆ1-5ã¾ãŸã¯practiceï¼‰
        
        // === OpenAI APIè¨­å®š ===
        const OPENAI_API_KEY = 'YOUR_API_KEY_HERE'; // ã“ã“ã«APIã‚­ãƒ¼ã‚’è¨­å®š
        // ãƒ†ã‚¹ãƒˆç”¨ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‹ã‚‰å…¥åŠ›ã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å¤–ã—ã¦ãã ã•ã„
        // const OPENAI_API_KEY = prompt('OpenAI APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
        
        // === åŒ»å­¦å®Ÿç¿’12æ™‚è¨ˆåˆ†é¡ã‚·ã‚¹ãƒ†ãƒ  ===
        const CLOCK_CATEGORIES = {
            0: { name: 'åˆ†é¡ä¸èƒ½', icon: 'â“', vector: {x: 0, y: 0} },
            1: { name: 'åœ°åŸŸåŒ»ç™‚', icon: 'ğŸ˜ï¸', vector: {x: -0.5, y: 0.8} },
            2: { name: 'åŒ»ç™‚å€«ç†', icon: 'âš–ï¸', vector: {x: -0.3, y: -0.5} },
            3: { name: 'åŒ»å­¦çŸ¥è­˜', icon: 'ğŸ“š', vector: {x: 0.8, y: -0.5} },
            4: { name: 'è¨ºå¯Ÿãƒ»æ‰‹æŠ€', icon: 'ğŸ©º', vector: {x: 0.9, y: -0.7} },
            5: { name: 'æ‚£è€…ã«å¯¾ã™ã‚‹å•é¡Œè§£æ±ºèƒ½åŠ›', icon: 'ğŸ¤', vector: {x: 0.5, y: -0.9} },
            6: { name: 'çµ±åˆçš„è‡¨åºŠ', icon: 'ğŸ¥', vector: {x: 0, y: -0.8} },
            7: { name: 'å¤šè·ç¨®é€£æº', icon: 'ğŸ‘¥', vector: {x: -0.5, y: -0.7} },
            8: { name: 'ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³', icon: 'ğŸ’¬', vector: {x: -0.8, y: -0.3} },
            9: { name: 'ä¸€èˆ¬æ•™é¤Š', icon: 'ğŸ“–', vector: {x: -0.9, y: 0.3} },
            10: { name: 'æ–½è¨­é€£æº', icon: 'ğŸ¥', vector: {x: -0.7, y: 0.7} },
            11: { name: 'ä¿å¥ãƒ»ç¦ç¥‰', icon: 'ğŸ›ï¸', vector: {x: -0.3, y: 0.9} },
            12: { name: 'çµ±åˆçš„ç¤¾ä¼š', icon: 'ğŸŒ', vector: {x: 0, y: 0.9} }
        };
        let userLevel = 1;
        let userExp = 0;
        const EXP_PER_RECORD = 20;
        const EXP_TO_LEVEL_UP = 100;

        // === 12æ™‚è¨ˆã‚«ãƒ†ã‚´ãƒªã®è‰²å®šç¾© ===
        const AI_CATEGORIES = {
            0: { name: 'â“ åˆ†é¡ä¸èƒ½', color: '#b2bec3' },
            1: { name: 'ğŸ˜ï¸ åœ°åŸŸåŒ»ç™‚', color: '#ff6b6b' },
            2: { name: 'âš–ï¸ åŒ»ç™‚å€«ç†', color: '#ff9ff3' },
            3: { name: 'ğŸ“š åŒ»å­¦çŸ¥è­˜', color: '#54a0ff' },
            4: { name: 'ğŸ©º è¨ºå¯Ÿãƒ»æ‰‹æŠ€', color: '#48dbfb' },
            5: { name: 'ğŸ¤ æ‚£è€…ã«å¯¾ã™ã‚‹å•é¡Œè§£æ±ºèƒ½åŠ›', color: '#1dd1a1' },
            6: { name: 'ğŸ¥ çµ±åˆçš„è‡¨åºŠ', color: '#10ac84' },
            7: { name: 'ğŸ‘¥ å¤šè·ç¨®é€£æº', color: '#feca57' },
            8: { name: 'ğŸ’¬ ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³', color: '#ff9ff3' },
            9: { name: 'ğŸ“– ä¸€èˆ¬æ•™é¤Š', color: '#dfe6e9' },
            10: { name: 'ğŸ¥ æ–½è¨­é€£æº', color: '#a29bfe' },
            11: { name: 'ğŸ›ï¸ ä¿å¥ãƒ»ç¦ç¥‰', color: '#6c5ce7' },
            12: { name: 'ğŸŒ çµ±åˆçš„ç¤¾ä¼š', color: '#fd79a8' }
        };

        // === ä½“é¨“è¨˜éŒ²é€ä¿¡ ===
        async function submitExperience() {
            const experienceText = document.getElementById('experienceText').value.trim();
            
            if (!experienceText) {
                showStatus('ä½“é¨“å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'error');
                return;
            }

            // UIçŠ¶æ…‹ã‚’å‡¦ç†ä¸­ã«å¤‰æ›´
            const submitBtn = document.querySelector('.submit-btn');
            const submitText = document.getElementById('submitText');
            const submitLoading = document.getElementById('submitLoading');
            
            submitBtn.disabled = true;
            submitText.style.display = 'none';
            submitLoading.style.display = 'inline-block';

            try {
                // AIåˆ†é¡ã‚’å®Ÿè¡Œ
                showStatus('ğŸ¤– AIåˆ†æä¸­...', 'info');
                const aiResult = await classifyWithAI(experienceText);
                
                // ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†ã§å³åº§ã«è¡¨ç¤º
                const localRecord = {
                    id: ++recordIdCounter,
                    originalText: experienceText,
                    timestamp: new Date(),
                    day: currentDay, // ç¾åœ¨ã®æ—¥ä»˜ã‚’è¨˜éŒ²
                    category: aiResult.category,
                    confidence: aiResult.confidence,
                    aiProcessed: true,
                    aiReason: aiResult.reason,
                    depth: aiResult.depth,
                    vector: aiResult.vector,
                    consistency: aiResult.consistency
                };

                records.unshift(localRecord);
                
                // çµŒé¨“å€¤ã‚’è¿½åŠ 
                addExperience(EXP_PER_RECORD);
                
                updateAllViews();
                showStatus('âœ… é€ä¿¡ã—ã¾ã—ãŸï¼', 'success');

                // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§GASå‡¦ç†
                try {
                    const response = await fetch(window.location.href, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'processExperience',
                            studentName: studentName,
                            experienceText: experienceText
                        })
                    });

                    if (response.ok) {
                        const result = await response.json();
                        if (result.success) {
                            // GASå‡¦ç†æˆåŠŸæ™‚ã«ãƒ­ãƒ¼ã‚«ãƒ«è¨˜éŒ²ã‚’æ›´æ–°
                            localRecord.category = result.classificationResult.category;
                            localRecord.confidence = result.classificationResult.confidence;
                            localRecord.aiProcessed = result.classificationResult.aiProcessed;
                            updateAllViews();
                            showStatus('ğŸ¤– AIåˆ†æå®Œäº†ï¼åˆ†é¡çµæœã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚', 'success');
                        }
                    }
                } catch (gasError) {
                    console.log('GASå‡¦ç†ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«å‹•ä½œï¼‰:', gasError);
                }

            } catch (error) {
                // ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã¯æ­£å¸¸å‹•ä½œãªã®ã§ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã—ãªã„
                console.log('ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®å‹•ä½œ:', error);
            } finally {
                // UIçŠ¶æ…‹ã‚’å…ƒã«æˆ»ã™
                submitBtn.disabled = false;
                submitText.style.display = 'inline-block';
                submitLoading.style.display = 'none';
                
                // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
                document.getElementById('experienceText').value = '';
            }
        }

        // === ãƒ¢ãƒ‹ã‚¿ãƒ¼åˆ‡ã‚Šæ›¿ãˆ ===
        function switchMonitor(monitorId) {
            // å…¨ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚’éè¡¨ç¤º
            document.querySelectorAll('.monitor').forEach(monitor => {
                monitor.classList.remove('active');
            });

            // å…¨ã‚¿ãƒ–ã® active ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
            document.querySelectorAll('.monitor-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // å…¨çµ±è¨ˆè¡¨ç¤ºã‚’éè¡¨ç¤º
            document.querySelectorAll('.stats-display').forEach(stats => {
                stats.style.display = 'none';
            });

            // é¸æŠã•ã‚ŒãŸãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚’è¡¨ç¤º
            document.getElementById(monitorId).classList.add('active');
            event.target.classList.add('active');

            // å¯¾å¿œã™ã‚‹çµ±è¨ˆã‚’è¡¨ç¤º
            const statsId = 'stats-' + monitorId;
            const statsElement = document.getElementById(statsId);
            if (statsElement) {
                statsElement.style.display = 'block';
            }

            currentMonitor = monitorId;

            // ãƒ¢ãƒ‹ã‚¿ãƒ¼åˆ‡ã‚Šæ›¿ãˆæ™‚ã«è¡¨ç¤ºã‚’æ›´æ–°
            updateAllViews();
        }

        // === å…¨ãƒ“ãƒ¥ãƒ¼æ›´æ–° ===
        // === çµŒé¨“å€¤è¿½åŠ  ===
        function addExperience(exp) {
            userExp += exp;
            
            // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒã‚§ãƒƒã‚¯
            while (userExp >= EXP_TO_LEVEL_UP) {
                userExp -= EXP_TO_LEVEL_UP;
                userLevel++;
                showStatus(`ğŸ‰ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ LV.${userLevel}ã«ãªã‚Šã¾ã—ãŸï¼`, 'success');
            }
            
            updateExpDisplay();
        }

        // === 12æ™‚è¨ˆAIåˆ†é¡é–¢æ•° ===
        async function classifyWithAI(recordText) {
            try {
                const prompt = `åŒ»å­¦ç”Ÿã®å®Ÿç¿’è¨˜éŒ²ã‚’2ã¤ã®ç‹¬ç«‹ã—ãŸæ–¹æ³•ã§åˆ†æã—ã¦ãã ã•ã„ã€‚

è¨˜éŒ²: "${recordText}"

ã€ã‚¿ã‚¹ã‚¯1: 12æ™‚è¨ˆåˆ†é¡ã€‘
ä»¥ä¸‹ã®13ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰æœ€ã‚‚é©åˆ‡ãªã‚‚ã®ã‚’1ã¤é¸ã‚“ã§ãã ã•ã„ï¼š

0æ™‚: åˆ†é¡ä¸èƒ½ï¼ˆåŒ»å­¦å®Ÿç¿’ã¨ã®é–¢é€£ãŒä¸æ˜ç¢ºã€æ„å›³ãŒèª­ã¿å–ã‚Œãªã„ï¼‰
1æ™‚: åœ°åŸŸåŒ»ç™‚ï¼ˆè¨ªå•è¨ºç™‚ã€åœ¨å®…åŒ»ç™‚ã€åœ°åŸŸç‰¹æ€§ï¼‰
2æ™‚: åŒ»ç™‚å€«ç†ï¼ˆå€«ç†ã€æ³•å¾‹ã€è¦ç¯„ï¼‰
3æ™‚: åŒ»å­¦çŸ¥è­˜ï¼ˆç–¾æ‚£ã€ç—‡å€™ã€åŸºç¤åŒ»å­¦ï¼‰
4æ™‚: è¨ºå¯Ÿãƒ»æ‰‹æŠ€ï¼ˆè¨ºå¯Ÿã‚¹ã‚­ãƒ«ã€æ¤œæŸ»æ‰‹æŠ€ï¼‰
5æ™‚: æ‚£è€…ã«å¯¾ã™ã‚‹å•é¡Œè§£æ±ºèƒ½åŠ›ï¼ˆå€‹åˆ¥å¯¾å¿œã€æ²»ç™‚æ–¹é‡æ±ºå®šï¼‰
6æ™‚: çµ±åˆçš„è‡¨åºŠï¼ˆè‡¨åºŠèƒ½åŠ›ã®çµ±åˆï¼‰
7æ™‚: å¤šè·ç¨®é€£æºï¼ˆãƒãƒ¼ãƒ åŒ»ç™‚ã€é™¢å†…é€£æºï¼‰
8æ™‚: ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå¯¾äººèƒ½åŠ›ï¼‰
9æ™‚: ä¸€èˆ¬æ•™é¤Šï¼ˆåŒ»å­¦ä»¥å¤–ã®çŸ¥è­˜ï¼‰
10æ™‚: æ–½è¨­é€£æºï¼ˆç—…é™¢é–“é€£æºã€ç´¹ä»‹ï¼‰
11æ™‚: ä¿å¥ãƒ»ç¦ç¥‰ï¼ˆä»‹è­·ã€ä¿å¥äº‹æ¥­ï¼‰
12æ™‚: çµ±åˆçš„ç¤¾ä¼šï¼ˆç¤¾ä¼šåŒ»å­¦ã®çµ±åˆï¼‰

â€»ã€Œç©ºãŒé’ã‹ã£ãŸã€ã®ã‚ˆã†ãªè¨˜éŒ²ã§åŒ»å­¦å®Ÿç¿’ã¨ã®é–¢é€£ãŒä¸æ˜ãªå ´åˆã¯0æ™‚ã‚’é¸æŠ

ã€ã‚¿ã‚¹ã‚¯2: æ·±åº¦ã¨ãƒ™ã‚¯ãƒˆãƒ«åº§æ¨™ã€‘
ä»¥ä¸‹ã‚’ç‹¬ç«‹ã—ã¦åˆ¤å®šã—ã¦ãã ã•ã„ï¼š

æ·±åº¦ï¼ˆ0-4ï¼‰:
0: çŸ¥ã‚‰ãªã„
1: çŸ¥ã£ã¦ã„ã‚‹ï¼ˆåç§°ãƒ¬ãƒ™ãƒ«ï¼‰
2: ç†è§£ã—ã¦ã„ã‚‹ï¼ˆèƒŒæ™¯ãƒ»å› æœé–¢ä¿‚ï¼‰
3: èª¬æ˜ã§ãã‚‹ï¼ˆå†ç¾æ€§ã¯ä½ã„ï¼‰
4: å®šç€ã—ã¦ã„ã‚‹ï¼ˆçµ±åˆçš„ãƒ¬ãƒ™ãƒ«ï¼‰

åº§æ¨™:
xè»¸ï¼ˆ-1.0ã€œ1.0ï¼‰: -1=non-technical skill â† â†’ +1=technical skill
yè»¸ï¼ˆ-1.0ã€œ1.0ï¼‰: -1=è‡¨åºŠï¼ˆãƒ™ãƒƒãƒ‰ã‚µã‚¤ãƒ‰ï¼‰ â† â†’ +1=åœ°åŸŸãƒ»ç¤¾ä¼š

å›ç­”å½¢å¼:
{
  "clock_category": æ•°å€¤(0-12),
  "clock_reason": "åˆ†é¡ç†ç”±",
  "depth": æ•°å€¤(0-4),
  "depth_reason": "æ·±åº¦åˆ¤å®šç†ç”±",
  "vector": {
    "x": æ•°å€¤(-1.0ã€œ1.0),
    "y": æ•°å€¤(-1.0ã€œ1.0)
  },
  "vector_reason": "åº§æ¨™åˆ¤å®šç†ç”±"
}`;

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [{ role: 'user', content: prompt }],
                        temperature: 0.3,
                        response_format: { type: "json_object" }
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const data = await response.json();
                const result = JSON.parse(data.choices[0].message.content);
                
                // æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
                let consistency_score = 100;
                if (result.clock_category === 0) {
                    // åˆ†é¡ä¸èƒ½ã®å ´åˆã¯æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ã‚’ã‚¹ã‚­ãƒƒãƒ—
                    consistency_score = 0; // æ•´åˆæ€§ã¯è©•ä¾¡ä¸èƒ½
                } else {
                    const expectedVector = CLOCK_CATEGORIES[result.clock_category].vector;
                    const deviation = {
                        x: Math.abs(expectedVector.x - result.vector.x),
                        y: Math.abs(expectedVector.y - result.vector.y)
                    };
                    consistency_score = 100 - (deviation.x + deviation.y) * 50;
                }
                
                return {
                    category: result.clock_category,
                    confidence: Math.max(50, consistency_score),
                    reason: result.clock_reason,
                    depth: result.depth,
                    vector: result.vector,
                    consistency: consistency_score > 70
                };
            } catch (error) {
                console.error('AIåˆ†é¡ã‚¨ãƒ©ãƒ¼:', error);
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                return {
                    category: 7,
                    confidence: 50,
                    reason: 'AIåˆ†é¡ã«å¤±æ•—ã—ã¾ã—ãŸ',
                    depth: 1,
                    vector: {x: 0, y: 0},
                    consistency: false
                };
            }
        }
        
        // === çµŒé¨“å€¤è¡¨ç¤ºæ›´æ–° ===
        function updateExpDisplay() {
            // è¨˜éŒ²å›æ•°æ›´æ–°
            const recordCount = records.filter(r => r.day === currentDay).length;
            document.getElementById('recordCount').textContent = recordCount;
            document.getElementById('recordCount2').textContent = recordCount;
            
            // ãƒ¬ãƒ™ãƒ«æ›´æ–°
            document.getElementById('userLevel').textContent = userLevel;
            document.getElementById('userLevel2').textContent = userLevel;
            
            // çµŒé¨“å€¤ãƒãƒ¼æ›´æ–°ï¼ˆéš ã—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦å‹•ä½œï¼‰
            const expPercent = (userExp / EXP_TO_LEVEL_UP) * 100;
            document.getElementById('expBar').style.width = expPercent + '%';
            document.getElementById('expBar2').style.width = expPercent + '%';
        }

        function updateAllViews() {
            updateRecordsList();
            updateOrganizedView();
            updateStatistics();
            updateExpDisplay();
        }

        // === ç¾åœ¨ã®æ—¥ä»˜ã®è¨˜éŒ²ã‚’å–å¾— ===
        function getCurrentDayRecords() {
            return records.filter(record => record.day === currentDay);
        }

        // === è¨˜éŒ²ãƒªã‚¹ãƒˆæ›´æ–°ï¼ˆãƒ¢ãƒ‹ã‚¿ãƒ¼1ï¼‰ ===
        function updateRecordsList() {
            const recordsList = document.getElementById('recordsList');
            const dayRecords = getCurrentDayRecords();
            
            if (dayRecords.length === 0) {
                recordsList.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ“</div>
                        <p>ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“<br>ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰æœ€åˆã®è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</p>
                    </div>
                `;
                return;
            }

            const html = dayRecords.map(record => {
                const category = AI_CATEGORIES[record.category] || AI_CATEGORIES.other;
                const timeStr = record.timestamp.toLocaleString('ja-JP', {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                return `
                    <div class="record-item" data-id="${record.id}">
                        <div class="record-header">
                            <div class="record-timestamp">${timeStr}</div>
                            <div class="record-actions">
                                <button class="record-btn edit-btn" onclick="editRecord(${record.id})" title="ç·¨é›†">
                                    âœ’ï¸
                                </button>
                                <button class="record-btn delete-btn" onclick="deleteRecord(${record.id})" title="å‰Šé™¤">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        </div>
                        <div class="record-text">${record.originalText}</div>
                        <div>
                            <span class="record-category">${category.name}</span>
                            ${record.aiProcessed ? '<span class="record-ai-indicator">ğŸ¤–</span>' : ''}
                            <span style="margin-left: 6px; color: #666; font-size: 0.75rem;">
                                ${record.confidence}%
                            </span>
                        </div>
                    </div>
                `;
            }).join('');

            recordsList.innerHTML = html;
        }

        // === æ•´ç†ãƒ“ãƒ¥ãƒ¼æ›´æ–°ï¼ˆãƒ¢ãƒ‹ã‚¿ãƒ¼2ï¼‰ ===
        function updateOrganizedView() {
            const organizedView = document.getElementById('organizedView');
            const dayRecords = getCurrentDayRecords();
            
            if (dayRecords.length === 0) {
                organizedView.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ¤–</div>
                        <p>è¨˜éŒ²ã‚’è¿½åŠ ã™ã‚‹ã¨<br>AIåˆ†æã«ã‚ˆã‚‹12æ™‚è¨ˆåˆ†é¡ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
                    </div>
                `;
                return;
            }

            // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            const groupedRecords = {};
            dayRecords.forEach(record => {
                const category = record.category || 'other';
                if (!groupedRecords[category]) {
                    groupedRecords[category] = [];
                }
                groupedRecords[category].push(record);
            });

            // HTMLç”Ÿæˆ
            let html = '';
            for (const [categoryId, categoryRecords] of Object.entries(groupedRecords)) {
                const category = AI_CATEGORIES[categoryId] || AI_CATEGORIES[7]; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯è‡ªå·±çœå¯Ÿ
                
                html += `
                    <div class="category-section">
                        <div class="category-header">
                            ${category.name} (${categoryRecords.length}ä»¶)
                        </div>
                        <div class="category-content">
                            ${categoryRecords.map(record => `
                                <div class="category-item">
                                    <div class="category-text">${record.originalText}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            organizedView.innerHTML = html;
        }

        // === çµ±è¨ˆæ›´æ–° ===
        function updateStatistics() {
            // åŸºæœ¬çµ±è¨ˆ
            document.getElementById('totalRecords').textContent = records.length;
            
            // ä»Šæ—¥ã®è¨˜éŒ²æ•°
            const today = new Date().toDateString();
            const todayCount = records.filter(r => r.timestamp.toDateString() === today).length;
            document.getElementById('todayRecords').textContent = todayCount;
            
            // AIå‡¦ç†æ¸ˆã¿æ•°
            const aiCount = records.filter(r => r.aiProcessed).length;
            document.getElementById('aiProcessed').textContent = aiCount;

            // ã‚«ãƒ†ã‚´ãƒªæ•°
            const uniqueCategories = new Set(records.map(r => r.category)).size;
            document.getElementById('categoryCount').textContent = uniqueCategories;

            // å¹³å‡ä¿¡é ¼åº¦
            if (records.length > 0) {
                const avgConfidence = Math.round(
                    records.reduce((sum, r) => sum + r.confidence, 0) / records.length
                );
                document.getElementById('avgConfidence').textContent = avgConfidence + '%';
            }
        }

        // === è¨˜éŒ²ç·¨é›† ===
        function editRecord(recordId) {
            const record = records.find(r => r.id === recordId);
            if (!record) return;

            const recordElement = document.querySelector(`[data-id="${recordId}"]`);
            const textElement = recordElement.querySelector('.record-text');
            
            // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ
            recordElement.classList.add('edit-mode');
            textElement.innerHTML = `
                <textarea class="edit-textarea">${record.originalText}</textarea>
                <div class="edit-actions">
                    <button class="record-btn save-btn" onclick="saveRecord(${recordId})" title="ä¿å­˜">âœ“</button>
                    <button class="record-btn cancel-btn" onclick="cancelEdit(${recordId})" title="ã‚­ãƒ£ãƒ³ã‚»ãƒ«">Ã—</button>
                </div>
            `;
        }

        // === è¨˜éŒ²ä¿å­˜ ===
        function saveRecord(recordId) {
            const record = records.find(r => r.id === recordId);
            if (!record) return;

            const recordElement = document.querySelector(`[data-id="${recordId}"]`);
            const textarea = recordElement.querySelector('.edit-textarea');
            const newText = textarea.value.trim();

            if (newText) {
                record.originalText = newText;
                updateAllViews();
                showStatus('âœ… è¨˜éŒ²ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚', 'success');
            }
        }

        // === ç·¨é›†ã‚­ãƒ£ãƒ³ã‚»ãƒ« ===
        function cancelEdit(recordId) {
            updateAllViews();
        }

        // === è¨˜éŒ²å‰Šé™¤ ===
        function deleteRecord(recordId) {
            if (confirm('ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                records = records.filter(r => r.id !== recordId);
                updateAllViews();
                showStatus('ğŸ—‘ï¸ è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚', 'warning');
            }
        }

        // === æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ ===
        function generateDailyReport() {
            const dailyReport = document.getElementById('dailyReport');
            const dayRecords = getCurrentDayRecords();
            
            if (dayRecords.length === 0) {
                showStatus(`${currentDay === 'practice' ? 'ç·´ç¿’ç”¨' : `${currentDay}æ—¥ç›®`}ã®è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚`, 'warning');
                return;
            }

            // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«åˆ†é¡
            const categoryGroups = {};
            dayRecords.forEach(record => {
                const category = record.category || 'other';
                if (!categoryGroups[category]) {
                    categoryGroups[category] = [];
                }
                categoryGroups[category].push(record);
            });

            // ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
            let reportHtml = `
                <div class="report-content">
                    <h4>ğŸ“‹ ${currentDay === 'practice' ? 'ç·´ç¿’ç”¨' : `${currentDay}æ—¥ç›®`}ã®å®Ÿç¿’ãƒ¬ãƒãƒ¼ãƒˆ</h4>
                    
                    <div class="report-section">
                        <h4>ğŸ“Š æ¦‚è¦</h4>
                        <p>${currentDay === 'practice' ? 'ç·´ç¿’' : `${currentDay}æ—¥ç›®`}ã¯${dayRecords.length}ä»¶ã®å­¦ç¿’è¨˜éŒ²ã‚’ä½œæˆã—ã¾ã—ãŸã€‚</p>
                        <p>è¨˜éŒ²ã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒª: ${Object.keys(categoryGroups).length}é …ç›®</p>
                    </div>
            `;

            // ã‚«ãƒ†ã‚´ãƒªåˆ¥è©³ç´°
            for (const [categoryId, categoryRecords] of Object.entries(categoryGroups)) {
                const category = AI_CATEGORIES[categoryId] || AI_CATEGORIES[7]; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯è‡ªå·±çœå¯Ÿ
                
                reportHtml += `
                    <div class="report-section">
                        <h4>${category.name}</h4>
                        <ul>
                            ${categoryRecords.map(record => `
                                <li>${record.originalText}</li>
                            `).join('')}
                        </ul>
                    </div>
                `;
            }

            reportHtml += `
                    <div class="report-section">
                        <h4>ğŸ’¡ ã¾ã¨ã‚</h4>
                        <p>ä»Šæ—¥ã®å®Ÿç¿’ã§ã¯æ§˜ã€…ãªå­¦ã³ãŒã‚ã‚Šã¾ã—ãŸã€‚ç‰¹ã«${Object.keys(categoryGroups)[0] ? AI_CATEGORIES[Object.keys(categoryGroups)[0]].name : 'å®Ÿç¿’ä½“é¨“'}ã«é–¢ã™ã‚‹ç†è§£ãŒæ·±ã¾ã‚Šã¾ã—ãŸã€‚</p>
                    </div>
                </div>
            `;

            dailyReport.innerHTML = reportHtml;
            showStatus('ğŸ“Š æœ¬æ—¥ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼', 'success');
        }

        // === æ¬¡ã®æ—¥ã¸é€²ã‚€ ===
        // === å‰ã®æ—¥ã¸æ©Ÿèƒ½ ===
        function previousDay() {
            const currentDayElement = document.getElementById('currentDay');
            if (currentDayElement) {
                const currentDay = parseInt(currentDayElement.textContent) || 1;
                if (currentDay > 1) {
                    currentDayElement.textContent = currentDay - 1;
                    showStatus(`Day ${currentDay - 1}ã«æˆ»ã‚Šã¾ã—ãŸ`, 'success');
                    // è¡¨ç¤ºã‚’æ›´æ–°
                    updateAllViews();
                } else {
                    showStatus('ã“ã‚Œä»¥ä¸Šå‰ã®æ—¥ã«ã¯æˆ»ã‚Œã¾ã›ã‚“', 'error');
                }
            }
        }

        async function advanceDay() {
            const studentName = document.getElementById('studentName').value.trim();
            
            if (!studentName) {
                showStatus('å­¦ç”Ÿåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'error');
                return;
            }

            try {
                // ãƒ­ãƒ¼ã‚«ãƒ«ã§æ—¥æ•°ã‚’é€²ã‚ã‚‹
                const currentDayElement = document.getElementById('currentDay');
                const currentDayText = currentDayElement.textContent;
                const currentDayNum = parseInt(currentDayText.replace('æ—¥ç›®', '')) || 1;
                const nextDay = Math.min(currentDayNum + 1, 5);
                
                currentDayElement.textContent = nextDay + 'æ—¥ç›®';
                showStatus(`âœ… ${nextDay}æ—¥ç›®ã«é€²ã¿ã¾ã—ãŸï¼`, 'success');

                // GASé€£æºï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰
                try {
                    const response = await fetch(window.location.href, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'advanceDay',
                            studentName: studentName
                        })
                    });

                    if (response.ok) {
                        const result = await response.json();
                        console.log('æ—¥æ¬¡é€²è¡Œçµæœ:', result);
                    }
                } catch (gasError) {
                    console.log('GASæ—¥æ¬¡é€²è¡Œã‚¹ã‚­ãƒƒãƒ—:', gasError);
                }

            } catch (error) {
                console.error('æ—¥æ¬¡é€²è¡Œã‚¨ãƒ©ãƒ¼:', error);
                showStatus('âŒ æ—¥æ¬¡é€²è¡Œã«å¤±æ•—ã—ã¾ã—ãŸã€‚', 'error');
            }
        }


        // === ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º ===
        function showStatus(message, type = 'info') {
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
            
            // 5ç§’å¾Œã«æ¶ˆå»
            setTimeout(() => {
                statusMessage.innerHTML = '';
            }, 5000);
        }

        // === ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³é–‹é–‰ ===
        function toggleDayDropdown() {
            const dropdown = document.getElementById('dayDropdown');
            dropdown.classList.toggle('active');
        }

        // === æ—¥ä»˜é¸æŠæ©Ÿèƒ½ ===
        function selectDay(day) {
            currentDay = day;
            
            // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.day-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // ãƒ©ãƒ™ãƒ«ã‚’æ›´æ–°
            const dayLabel = document.getElementById('currentDayLabel');
            dayLabel.textContent = day === 'practice' ? 'ç·´ç¿’ç”¨' : `${day}æ—¥ç›®`;
            
            
            // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’é–‰ã˜ã‚‹
            document.getElementById('dayDropdown').classList.remove('active');
            
            // è¡¨ç¤ºã‚’æ›´æ–°
            updateAllViews();
            
        }


        // === åˆæœŸåŒ– ===
        document.addEventListener('DOMContentLoaded', function() {
            console.log('MULTAs ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
            
            // åˆæœŸè¡¨ç¤ºè¨­å®š
            document.getElementById('stats-monitor1').style.display = 'block';
            
            updateAllViews();
            
            // Enter ã‚­ãƒ¼ã§ã®é€ä¿¡
            document.getElementById('experienceText').addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'Enter') {
                    submitExperience();
                }
            });

            // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®å‹•çš„ãƒªã‚µã‚¤ã‚º
            const textarea = document.getElementById('experienceText');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });

            // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.day-display')) {
                    document.getElementById('dayDropdown').classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
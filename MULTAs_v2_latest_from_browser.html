<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MULTAs v2.1 - åŒ»å­¦å®Ÿç¿’ãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ï¼ˆAIåˆ†é¡å¯¾å¿œï¼‰</title>
    <style>
        /* === ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Yu Gothic UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            color: #333;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
        }

        /* === ãƒ˜ãƒƒãƒ€ãƒ¼ === */
        .header {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            text-align: center;
            color: white;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        /* === ãƒ¢ãƒ‹ã‚¿ãƒ¼åˆ‡ã‚Šæ›¿ãˆã‚¿ãƒ– === */
        .monitor-tabs {
            display: flex;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            flex-shrink: 0;
            justify-content: center;
        }

        .monitor-tab {
            padding: 10px 24px;
            border: 2px solid #4a9eff;
            background: white;
            color: #4a9eff;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 25px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: 140px;
            text-align: center;
        }

        .monitor-tab:hover {
            background: #e8f2ff;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(74, 158, 255, 0.2);
        }

        .monitor-tab.active {
            background: #4a9eff;
            color: white;
            border-color: #4a9eff;
            box-shadow: 0 4px 12px rgba(74, 158, 255, 0.3);
        }

        /* === ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ === */
        .main-content {
            flex: 1;
            padding: 0;
            background: white;
            display: flex;
            flex-direction: column;
            min-height: 0;
            overflow: hidden;
        }

        /* === çµ±è¨ˆå›ºå®šã‚¨ãƒªã‚¢ === */
        .monitor-stats {
            background: white;
            padding: 12px 20px 8px;
            border-bottom: 1px solid #f0f0f0;
            flex-shrink: 0;
        }

        /* === ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ === */
        .monitor-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px 20px;
            min-height: 0;
        }

        /* === ãƒ¢ãƒ‹ã‚¿ãƒ¼è¡¨ç¤º === */
        .monitor {
            display: none;
            height: 100%;
            flex-direction: column;
        }

        .monitor.active {
            display: flex;
        }

        .monitor h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.1rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 6px;
            margin: 0 0 15px 0;
        }

        /* === çµ±è¨ˆã‚«ãƒ¼ãƒ‰ === */
        .stats-grid {
            display: flex;
            gap: 6px;
            margin-bottom: 0;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .stat-card {
            background: rgba(102, 126, 234, 0.03);
            border-radius: 5px;
            padding: 4px 8px;
            text-align: center;
            border: 1px solid rgba(102, 126, 234, 0.08);
            flex: 1;
            min-width: 60px;
            max-width: 80px;
        }

        .stat-number {
            font-size: 0.85rem;
            font-weight: bold;
            color: rgba(102, 126, 234, 0.7);
            margin-bottom: 1px;
        }

        .stat-label {
            color: #999;
            font-size: 0.65rem;
            line-height: 1.1;
        }

        /* === è¨˜éŒ²ã‚¢ã‚¤ãƒ†ãƒ  === */
        .record-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .record-item:hover {
            transform: translateX(3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-left-color: #5a67d8;
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .record-timestamp {
            color: #666;
            font-size: 0.8rem;
        }

        .record-actions {
            display: flex;
            gap: 6px;
        }

        .record-btn {
            padding: 5px 9px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .edit-btn {
            background: #ffc107;
            color: #333;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        .record-text {
            margin-bottom: 14px;
            line-height: 1.8;
            font-size: 1.2rem;
            color: #333;
            font-weight: 500;
            word-wrap: break-word;
            letter-spacing: 0.02em;
        }

        .record-category {
            display: inline-block;
            padding: 5px 10px;
            background: #e3f2fd;
            color: #1976d2;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .record-ai-indicator {
            display: inline-block;
            margin-left: 8px;
            padding: 3px 7px;
            background: #4caf50;
            color: white;
            border-radius: 10px;
            font-size: 0.75rem;
        }

        /* === ã‚«ãƒ†ã‚´ãƒªåˆ¥è¡¨ç¤º === */
        .category-section {
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            background: #f8f9fa;
        }

        .category-header {
            padding: 12px 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .category-content {
            padding: 15px;
        }

        .category-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 3px solid #667eea;
        }

        .category-item .category-text {
            font-size: 1.15rem;
            line-height: 1.8;
            color: #333;
            font-weight: 500;
            word-wrap: break-word;
            letter-spacing: 0.02em;
        }

        /* === ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º === */
        .report-content {
            background: white;
            border-radius: 10px;
            padding: 20px;
            line-height: 1.6;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .report-section {
            margin-bottom: 20px;
        }

        .report-section h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 4px;
        }

        /* === çµ±è¨ˆè¡¨ç¤º === */
        .stats-display {
            display: block;
        }

        .stats-display.hidden {
            display: none;
        }

        .report-actions {
            display: flex;
            gap: 8px;
            margin: 0;
        }

        .btn-secondary {
            flex: 1;
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-secondary:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        }

        .btn-advance {
            background: #17a2b8;
        }

        /* === ãƒœãƒˆãƒ å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  === */
        .bottom-input {
            background: white;
            border-top: 1px solid #e0e0e0;
            padding: 15px 20px 20px;
            flex-shrink: 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            position: relative;
            z-index: 10;
        }

        .input-row {
            display: flex;
            gap: 10px;
            align-items: flex-end;
            margin-bottom: 10px;
        }

        .student-name-input {
            flex: 0 0 120px;
        }

        .experience-input {
            flex: 1;
        }

        .input-row label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.85rem;
            font-weight: 600;
            color: #555;
        }

        .input-row input,
        .input-row textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .input-row input:focus,
        .input-row textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-row textarea {
            resize: none;
            height: 60px;
            min-height: 60px;
            max-height: 120px;
            padding-right: 60px;
        }

        .submit-btn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.4rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            z-index: 10;
        }

        .submit-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .submit-btn:active {
            transform: scale(0.95);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* === ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º === */
        .status-message {
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #b8daff;
        }

        /* === ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° === */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* === ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ === */
        .edit-mode {
            background: #fff3cd;
            border: 2px solid #ffc107;
        }

        .edit-textarea {
            width: 100%;
            min-height: 80px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.9rem;
            resize: vertical;
        }

        .edit-actions {
            margin-top: 8px;
            display: flex;
            gap: 8px;
        }

        .save-btn {
            background: #28a745;
            color: white;
        }

        .cancel-btn {
            background: #6c757d;
            color: white;
        }

        /* === ç©ºçŠ¶æ…‹è¡¨ç¤º === */
        .empty-state {
            text-align: center;
            color: #666;
            padding: 40px 20px;
            line-height: 1.6;
        }

        .empty-state .icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* === ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´ === */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .header p {
                font-size: 0.8rem;
            }

            .monitor-tab {
                font-size: 0.8rem;
                padding: 10px 6px;
            }

            .monitor h3 {
                font-size: 1rem;
                margin-bottom: 12px;
            }

            .bottom-input {
                padding: 12px 15px 15px;
            }

            .input-row {
                flex-direction: column;
                gap: 5px;
            }

            .student-name-input {
                flex: 1;
            }

            .stats-grid {
                gap: 4px;
                margin-bottom: 0;
            }

            .stat-card {
                padding: 3px 6px;
                min-width: 55px;
                max-width: 70px;
            }

            .stat-number {
                font-size: 0.75rem;
                color: rgba(102, 126, 234, 0.6);
            }

            .stat-label {
                font-size: 0.6rem;
                color: #aaa;
            }

            .report-actions {
                gap: 6px;
            }

            .record-text {
                font-size: 1.1rem;
                line-height: 1.7;
                letter-spacing: 0.01em;
            }

            .category-item .category-text {
                font-size: 1.05rem;
                line-height: 1.7;
                letter-spacing: 0.01em;
            }

            .monitor-stats {
                padding: 8px 15px 6px;
            }

            .monitor-content {
                padding: 12px 15px;
            }

            .monitor h3 {
                font-size: 1rem;
                margin-bottom: 12px;
            }

            .btn-secondary {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
        }

        /* === ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œå¯¾å¿œ === */
        .input-row textarea {
            transition: height 0.3s ease;
        }

        .input-row textarea:focus {
            height: 80px;
        }
    </style>
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header">
        <h1>ğŸ¥ MULTAs</h1>
        <p>Medical University Learning and Training Assessment system</p>
    </div>

    <!-- ãƒ¢ãƒ‹ã‚¿ãƒ¼åˆ‡ã‚Šæ›¿ãˆã‚¿ãƒ– -->
    <div class="monitor-tabs">
        <button class="monitor-tab active" onclick="switchMonitor('monitor1')">
            RECORD LOG
        </button>
        <button class="monitor-tab" onclick="switchMonitor('monitor2')">
            LIST DISPLAY
        </button>
        <button class="monitor-tab" onclick="switchMonitor('monitor3')">
            REPORT
        </button>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="main-content">
        
        <!-- çµ±è¨ˆå›ºå®šã‚¨ãƒªã‚¢ -->
        <div class="monitor-stats">
            <!-- ãƒ¢ãƒ‹ã‚¿ãƒ¼1ç”¨çµ±è¨ˆ -->
            <div id="stats-monitor1" class="stats-display">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalRecords">0</div>
                        <div class="stat-label">ç·è¨˜éŒ²</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="todayRecords">0</div>
                        <div class="stat-label">ä»Šæ—¥</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="aiProcessed">0</div>
                        <div class="stat-label">AIæ¸ˆ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="currentDay">1æ—¥ç›®</div>
                        <div class="stat-label">é€²åº¦</div>
                    </div>
                </div>
            </div>

            <!-- ãƒ¢ãƒ‹ã‚¿ãƒ¼2ç”¨çµ±è¨ˆ -->
            <div id="stats-monitor2" class="stats-display" style="display: none;">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="categoryCount">0</div>
                        <div class="stat-label">åˆ†é¡æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="avgConfidence">0%</div>
                        <div class="stat-label">ä¿¡é ¼åº¦</div>
                    </div>
                </div>
            </div>

            <!-- ãƒ¢ãƒ‹ã‚¿ãƒ¼3ç”¨çµ±è¨ˆ -->
            <div id="stats-monitor3" class="stats-display" style="display: none;">
                <div class="report-actions">
                    <button class="btn-secondary" onclick="generateDailyReport()">
                        ğŸ¤– ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
                    </button>
                    <button class="btn-secondary btn-advance" onclick="advanceDay()">
                        â¡ï¸ æ¬¡ã®æ—¥ã¸
                    </button>
                </div>
            </div>
        </div>

        <!-- ãƒ¢ãƒ‹ã‚¿ãƒ¼1: ãƒ­ã‚°ä¿å­˜ -->
        <div id="monitor1" class="monitor active">
            <div class="monitor-content">
                <h3>ğŸ“ æ™‚ç³»åˆ—ãƒ­ã‚°ä¿å­˜</h3>
                
                <div id="recordsList">
                    <div class="empty-state">
                        <div class="icon">ğŸ“</div>
                        <p>ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“<br>ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰æœ€åˆã®è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒ¢ãƒ‹ã‚¿ãƒ¼2: ä½“é¨“æ•´ç† -->
        <div id="monitor2" class="monitor">
            <div class="monitor-content">
                <h3>ğŸ¯ ä½“é¨“æ•´ç† (AIåˆ†æ)</h3>
                
                <div id="organizedView">
                    <div class="empty-state">
                        <div class="icon">ğŸ¤–</div>
                        <p>è¨˜éŒ²ã‚’è¿½åŠ ã™ã‚‹ã¨<br>AIåˆ†æã«ã‚ˆã‚‹8é …ç›®åˆ†é¡ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒ¢ãƒ‹ã‚¿ãƒ¼3: Dailyãƒ¬ãƒãƒ¼ãƒˆ -->
        <div id="monitor3" class="monitor">
            <div class="monitor-content">
                <h3>ğŸ“Š Dailyãƒ¬ãƒãƒ¼ãƒˆ</h3>
                
                <div id="dailyReport">
                    <div class="report-content">
                        <h4>ğŸ“‹ æœ¬æ—¥ã®å®Ÿç¿’ãƒ¬ãƒãƒ¼ãƒˆ</h4>
                        <div class="empty-state">
                            <div class="icon">ğŸ“Š</div>
                            <p>è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ã‹ã‚‰<br>ã€Œãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨<br>ãã®æ—¥ã®ä½“é¨“ã‚’ã¾ã¨ã‚ãŸãƒ¬ãƒãƒ¼ãƒˆãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒœãƒˆãƒ å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="bottom-input">
        <div class="input-row">
            <div class="student-name-input">
                <label for="studentName">å­¦ç”Ÿå</label>
                <input type="text" id="studentName" placeholder="å±±ç”°å¤ªéƒ" value="ãƒ†ã‚¹ãƒˆå­¦ç”Ÿ">
            </div>
            <div class="experience-input" style="position: relative;">
                <label for="experienceText">å®Ÿç¿’ä½“é¨“ãƒ»æ°—ã¥ã</label>
                <textarea id="experienceText" placeholder="ä»Šæ—¥ã®å®Ÿç¿’ã§å­¦ã‚“ã ã“ã¨ã€æ°—ã¥ã„ãŸã“ã¨ã€æ„Ÿã˜ãŸã“ã¨ã‚’è¨˜éŒ²..."></textarea>
                <button type="button" class="submit-btn" onclick="submitExperience()" title="é€ä¿¡">
                    <span id="submitText">âœˆï¸</span>
                    <span id="submitLoading" style="display: none;">
                        <span class="loading"></span>
                    </span>
                </button>
            </div>
        </div>

        <div id="statusMessage"></div>
    </div>

    <script>
        // === ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° ===
        let records = [];
        let recordIdCounter = 0;
        let currentMonitor = 'monitor1';

        // === åŒ»å­¦å®Ÿç¿’ã‚«ãƒ†ã‚´ãƒªå®šç¾© ===
        const AI_CATEGORIES = {
            medical_knowledge: { name: 'ğŸ‘¨â€âš•ï¸ åŒ»å¸«ã®ã‚¹ã‚­ãƒ«', color: '#ff6b6b' },
            patient_information: { name: 'ğŸ“‹ æ‚£è€…æƒ…å ±', color: '#4ecdc4' },
            patient_environment: { name: 'ğŸ  æ‚£è€…ã®ç”Ÿæ´»ç’°å¢ƒ', color: '#45b7d1' },
            team_collaboration: { name: 'ğŸ¤ ä»–è·ç¨®é€£æº', color: '#f9ca24' },
            community_medicine: { name: 'ğŸŒ åœ°åŸŸåŒ»ç™‚ãƒ»ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£', color: '#6c5ce7' },
            ethics_philosophy: { name: 'ğŸ“š åŒ»ç™‚å€«ç†ãƒ»å“²å­¦', color: '#a29bfe' },
            personal_growth: { name: 'âœ¨ è‡ªèº«ã®æˆé•·', color: '#fd79a8' },
            other: { name: 'ğŸ“ ãã®ä»–ãƒ»è¤‡åˆçš„', color: '#636e72' }
        };

        // === ä½“é¨“è¨˜éŒ²é€ä¿¡ ===
        async function submitExperience() {
            const studentName = document.getElementById('studentName').value.trim();
            const experienceText = document.getElementById('experienceText').value.trim();
            
            if (!studentName || !experienceText) {
                showStatus('å­¦ç”Ÿåã¨ä½“é¨“å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'error');
                return;
            }

            // UIçŠ¶æ…‹ã‚’å‡¦ç†ä¸­ã«å¤‰æ›´
            const submitBtn = document.querySelector('.submit-btn');
            const submitText = document.getElementById('submitText');
            const submitLoading = document.getElementById('submitLoading');
            
            submitBtn.disabled = true;
            submitText.style.display = 'none';
            submitLoading.style.display = 'inline-block';

            try {
                // ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†ã§å³åº§ã«è¡¨ç¤ºï¼ˆv1ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰
                const localRecord = {
                    id: ++recordIdCounter,
                    studentName: studentName,
                    originalText: experienceText,
                    timestamp: new Date(),
                    category: 'personal_growth', // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
                    confidence: 75,
                    aiProcessed: false
                };

                records.unshift(localRecord);
                updateAllViews();
                showStatus('âœ… é€ä¿¡ã—ã¾ã—ãŸï¼', 'success');

                // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
                document.getElementById('experienceText').value = '';

                // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§GASå‡¦ç†
                try {
                    const response = await fetch(window.location.href, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'processExperience',
                            studentName: studentName,
                            experienceText: experienceText
                        })
                    });

                    if (response.ok) {
                        const result = await response.json();
                        if (result.success) {
                            // GASå‡¦ç†æˆåŠŸæ™‚ã«ãƒ­ãƒ¼ã‚«ãƒ«è¨˜éŒ²ã‚’æ›´æ–°
                            localRecord.category = result.classificationResult.category;
                            localRecord.confidence = result.classificationResult.confidence;
                            localRecord.aiProcessed = result.classificationResult.aiProcessed;
                            updateAllViews();
                            showStatus('ğŸ¤– AIåˆ†æå®Œäº†ï¼åˆ†é¡çµæœã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚', 'success');
                        }
                    }
                } catch (gasError) {
                    console.log('GASå‡¦ç†ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«å‹•ä½œï¼‰:', gasError);
                }

            } catch (error) {
                console.error('è¨˜éŒ²å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
                showStatus('âŒ è¨˜éŒ²ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚', 'error');
            } finally {
                // UIçŠ¶æ…‹ã‚’å…ƒã«æˆ»ã™
                submitBtn.disabled = false;
                submitText.style.display = 'inline-block';
                submitLoading.style.display = 'none';
            }
        }

        // === ãƒ¢ãƒ‹ã‚¿ãƒ¼åˆ‡ã‚Šæ›¿ãˆ ===
        function switchMonitor(monitorId) {
            // å…¨ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚’éè¡¨ç¤º
            document.querySelectorAll('.monitor').forEach(monitor => {
                monitor.classList.remove('active');
            });

            // å…¨ã‚¿ãƒ–ã® active ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
            document.querySelectorAll('.monitor-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // å…¨çµ±è¨ˆè¡¨ç¤ºã‚’éè¡¨ç¤º
            document.querySelectorAll('.stats-display').forEach(stats => {
                stats.style.display = 'none';
            });

            // é¸æŠã•ã‚ŒãŸãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚’è¡¨ç¤º
            document.getElementById(monitorId).classList.add('active');
            event.target.classList.add('active');

            // å¯¾å¿œã™ã‚‹çµ±è¨ˆã‚’è¡¨ç¤º
            const statsId = 'stats-' + monitorId;
            const statsElement = document.getElementById(statsId);
            if (statsElement) {
                statsElement.style.display = 'block';
            }

            currentMonitor = monitorId;

            // ãƒ¢ãƒ‹ã‚¿ãƒ¼åˆ‡ã‚Šæ›¿ãˆæ™‚ã«è¡¨ç¤ºã‚’æ›´æ–°
            updateAllViews();
        }

        // === å…¨ãƒ“ãƒ¥ãƒ¼æ›´æ–° ===
        function updateAllViews() {
            updateRecordsList();
            updateOrganizedView();
            updateStatistics();
        }

        // === è¨˜éŒ²ãƒªã‚¹ãƒˆæ›´æ–°ï¼ˆãƒ¢ãƒ‹ã‚¿ãƒ¼1ï¼‰ ===
        function updateRecordsList() {
            const recordsList = document.getElementById('recordsList');
            
            if (records.length === 0) {
                recordsList.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ“</div>
                        <p>ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“<br>ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰æœ€åˆã®è¨˜éŒ²ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</p>
                    </div>
                `;
                return;
            }

            const html = records.map(record => {
                const category = AI_CATEGORIES[record.category] || AI_CATEGORIES.other;
                const timeStr = record.timestamp.toLocaleString('ja-JP', {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                return `
                    <div class="record-item" data-id="${record.id}">
                        <div class="record-header">
                            <div class="record-timestamp">${timeStr}</div>
                            <div class="record-actions">
                                <button class="record-btn edit-btn" onclick="editRecord(${record.id})">
                                    âœ’ï¸
                                </button>
                                <button class="record-btn delete-btn" onclick="deleteRecord(${record.id})">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        </div>
                        <div class="record-text">${record.originalText}</div>
                        <div>
                            <span class="record-category">${category.name}</span>
                            ${record.aiProcessed ? '<span class="record-ai-indicator">ğŸ¤–</span>' : ''}
                            <span style="margin-left: 6px; color: #666; font-size: 0.75rem;">
                                ${record.confidence}%
                            </span>
                        </div>
                    </div>
                `;
            }).join('');

            recordsList.innerHTML = html;
        }

        // === æ•´ç†ãƒ“ãƒ¥ãƒ¼æ›´æ–°ï¼ˆãƒ¢ãƒ‹ã‚¿ãƒ¼2ï¼‰ ===
        function updateOrganizedView() {
            const organizedView = document.getElementById('organizedView');
            
            if (records.length === 0) {
                organizedView.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ¤–</div>
                        <p>è¨˜éŒ²ã‚’è¿½åŠ ã™ã‚‹ã¨<br>AIåˆ†æã«ã‚ˆã‚‹8é …ç›®åˆ†é¡ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
                    </div>
                `;
                return;
            }

            // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            const groupedRecords = {};
            records.forEach(record => {
                const category = record.category || 'other';
                if (!groupedRecords[category]) {
                    groupedRecords[category] = [];
                }
                groupedRecords[category].push(record);
            });

            // HTMLç”Ÿæˆ
            let html = '';
            for (const [categoryId, categoryRecords] of Object.entries(groupedRecords)) {
                const category = AI_CATEGORIES[categoryId] || AI_CATEGORIES.other;
                
                html += `
                    <div class="category-section">
                        <div class="category-header">
                            ${category.name} (${categoryRecords.length}ä»¶)
                        </div>
                        <div class="category-content">
                            ${categoryRecords.map(record => `
                                <div class="category-item">
                                    <div style="font-size: 0.75rem; color: #666; margin-bottom: 8px;">
                                        ${record.timestamp.toLocaleString('ja-JP', {
                                            month: 'short',
                                            day: 'numeric',
                                            hour: '2-digit',
                                            minute: '2-digit'
                                        })}
                                        ${record.aiProcessed ? 'ğŸ¤–' : ''}
                                        (${record.confidence}%)
                                    </div>
                                    <div class="category-text">${record.originalText}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            organizedView.innerHTML = html;
        }

        // === çµ±è¨ˆæ›´æ–° ===
        function updateStatistics() {
            // åŸºæœ¬çµ±è¨ˆ
            document.getElementById('totalRecords').textContent = records.length;
            
            // ä»Šæ—¥ã®è¨˜éŒ²æ•°
            const today = new Date().toDateString();
            const todayCount = records.filter(r => r.timestamp.toDateString() === today).length;
            document.getElementById('todayRecords').textContent = todayCount;
            
            // AIå‡¦ç†æ¸ˆã¿æ•°
            const aiCount = records.filter(r => r.aiProcessed).length;
            document.getElementById('aiProcessed').textContent = aiCount;

            // ã‚«ãƒ†ã‚´ãƒªæ•°
            const uniqueCategories = new Set(records.map(r => r.category)).size;
            document.getElementById('categoryCount').textContent = uniqueCategories;

            // å¹³å‡ä¿¡é ¼åº¦
            if (records.length > 0) {
                const avgConfidence = Math.round(
                    records.reduce((sum, r) => sum + r.confidence, 0) / records.length
                );
                document.getElementById('avgConfidence').textContent = avgConfidence + '%';
            }
        }

        // === è¨˜éŒ²ç·¨é›† ===
        function editRecord(recordId) {
            const record = records.find(r => r.id === recordId);
            if (!record) return;

            const recordElement = document.querySelector(`[data-id="${recordId}"]`);
            const textElement = recordElement.querySelector('.record-text');
            
            // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ
            recordElement.classList.add('edit-mode');
            textElement.innerHTML = `
                <textarea class="edit-textarea">${record.originalText}</textarea>
                <div class="edit-actions">
                    <button class="record-btn save-btn" onclick="saveRecord(${recordId})">ğŸ’¾</button>
                    <button class="record-btn cancel-btn" onclick="cancelEdit(${recordId})">âŒ</button>
                </div>
            `;
        }

        // === è¨˜éŒ²ä¿å­˜ ===
        function saveRecord(recordId) {
            const record = records.find(r => r.id === recordId);
            if (!record) return;

            const recordElement = document.querySelector(`[data-id="${recordId}"]`);
            const textarea = recordElement.querySelector('.edit-textarea');
            const newText = textarea.value.trim();

            if (newText) {
                record.originalText = newText;
                updateAllViews();
                showStatus('âœ… è¨˜éŒ²ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚', 'success');
            }
        }

        // === ç·¨é›†ã‚­ãƒ£ãƒ³ã‚»ãƒ« ===
        function cancelEdit(recordId) {
            updateAllViews();
        }

        // === è¨˜éŒ²å‰Šé™¤ ===
        function deleteRecord(recordId) {
            if (confirm('ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                records = records.filter(r => r.id !== recordId);
                updateAllViews();
                showStatus('ğŸ—‘ï¸ è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚', 'warning');
            }
        }

        // === æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ ===
        function generateDailyReport() {
            const dailyReport = document.getElementById('dailyReport');
            
            if (records.length === 0) {
                showStatus('è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšä½“é¨“ã‚’è¨˜éŒ²ã—ã¦ãã ã•ã„ã€‚', 'warning');
                return;
            }

            // ä»Šæ—¥ã®è¨˜éŒ²ã‚’ãƒ•ã‚£ãƒ«ã‚¿
            const today = new Date().toDateString();
            const todayRecords = records.filter(r => r.timestamp.toDateString() === today);

            if (todayRecords.length === 0) {
                showStatus('ä»Šæ—¥ã®è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚', 'warning');
                return;
            }

            // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«åˆ†é¡
            const categoryGroups = {};
            todayRecords.forEach(record => {
                const category = record.category || 'other';
                if (!categoryGroups[category]) {
                    categoryGroups[category] = [];
                }
                categoryGroups[category].push(record);
            });

            // ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
            let reportHtml = `
                <div class="report-content">
                    <h4>ğŸ“‹ ${new Date().toLocaleDateString('ja-JP')}ã®å®Ÿç¿’ãƒ¬ãƒãƒ¼ãƒˆ</h4>
                    
                    <div class="report-section">
                        <h4>ğŸ“Š æ¦‚è¦</h4>
                        <p>æœ¬æ—¥ã¯${todayRecords.length}ä»¶ã®å­¦ç¿’è¨˜éŒ²ã‚’ä½œæˆã—ã¾ã—ãŸã€‚</p>
                        <p>è¨˜éŒ²ã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒª: ${Object.keys(categoryGroups).length}é …ç›®</p>
                    </div>
            `;

            // ã‚«ãƒ†ã‚´ãƒªåˆ¥è©³ç´°
            for (const [categoryId, categoryRecords] of Object.entries(categoryGroups)) {
                const category = AI_CATEGORIES[categoryId] || AI_CATEGORIES.other;
                
                reportHtml += `
                    <div class="report-section">
                        <h4>${category.name}</h4>
                        <ul>
                            ${categoryRecords.map(record => `
                                <li>${record.originalText}</li>
                            `).join('')}
                        </ul>
                    </div>
                `;
            }

            reportHtml += `
                    <div class="report-section">
                        <h4>ğŸ’¡ ã¾ã¨ã‚</h4>
                        <p>ä»Šæ—¥ã®å®Ÿç¿’ã§ã¯æ§˜ã€…ãªå­¦ã³ãŒã‚ã‚Šã¾ã—ãŸã€‚ç‰¹ã«${Object.keys(categoryGroups)[0] ? AI_CATEGORIES[Object.keys(categoryGroups)[0]].name : 'å®Ÿç¿’ä½“é¨“'}ã«é–¢ã™ã‚‹ç†è§£ãŒæ·±ã¾ã‚Šã¾ã—ãŸã€‚</p>
                    </div>
                </div>
            `;

            dailyReport.innerHTML = reportHtml;
            showStatus('ğŸ“Š æœ¬æ—¥ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼', 'success');
        }

        // === æ¬¡ã®æ—¥ã¸é€²ã‚€ ===
        async function advanceDay() {
            const studentName = document.getElementById('studentName').value.trim();
            
            if (!studentName) {
                showStatus('å­¦ç”Ÿåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'error');
                return;
            }

            try {
                // ãƒ­ãƒ¼ã‚«ãƒ«ã§æ—¥æ•°ã‚’é€²ã‚ã‚‹
                const currentDayElement = document.getElementById('currentDay');
                const currentDayText = currentDayElement.textContent;
                const currentDayNum = parseInt(currentDayText.replace('æ—¥ç›®', '')) || 1;
                const nextDay = Math.min(currentDayNum + 1, 5);
                
                currentDayElement.textContent = nextDay + 'æ—¥ç›®';
                showStatus(`âœ… ${nextDay}æ—¥ç›®ã«é€²ã¿ã¾ã—ãŸï¼`, 'success');

                // GASé€£æºï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰
                try {
                    const response = await fetch(window.location.href, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'advanceDay',
                            studentName: studentName
                        })
                    });

                    if (response.ok) {
                        const result = await response.json();
                        console.log('æ—¥æ¬¡é€²è¡Œçµæœ:', result);
                    }
                } catch (gasError) {
                    console.log('GASæ—¥æ¬¡é€²è¡Œã‚¹ã‚­ãƒƒãƒ—:', gasError);
                }

            } catch (error) {
                console.error('æ—¥æ¬¡é€²è¡Œã‚¨ãƒ©ãƒ¼:', error);
                showStatus('âŒ æ—¥æ¬¡é€²è¡Œã«å¤±æ•—ã—ã¾ã—ãŸã€‚', 'error');
            }
        }

        // === ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º ===
        function showStatus(message, type = 'info') {
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
            
            // 5ç§’å¾Œã«æ¶ˆå»
            setTimeout(() => {
                statusMessage.innerHTML = '';
            }, 5000);
        }

        // === åˆæœŸåŒ– ===
        document.addEventListener('DOMContentLoaded', function() {
            console.log('MULTAs ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
            
            // åˆæœŸè¡¨ç¤ºè¨­å®š
            document.getElementById('stats-monitor1').style.display = 'block';
            
            updateAllViews();
            
            // Enter ã‚­ãƒ¼ã§ã®é€ä¿¡
            document.getElementById('experienceText').addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'Enter') {
                    submitExperience();
                }
            });

            // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®å‹•çš„ãƒªã‚µã‚¤ã‚º
            const textarea = document.getElementById('experienceText');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });
        });
    </script>
</body>
</html>
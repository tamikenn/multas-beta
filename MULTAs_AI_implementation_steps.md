# MULTAs v2 AI実装手順

## 🎯 現在の状況
- ✅ v1: コメント累積保存モジュール（動作中）
- ✅ v2: UIとモード切り替え（実装済み）
- 🔄 v2: AI処理部分（これから実装）

## 📋 実装手順

### 1. GASプロジェクトの準備

1. **GASファイルの更新**
   - `MULTAs_simple_AI_implementation.gs`の内容をGASプロジェクトに追加
   - 既存の`doGet`関数があれば置き換え

2. **OpenAI APIキーの設定**
   ```javascript
   // GASエディタで一度だけ実行
   function setupOpenAIKey() {
     const apiKey = 'sk-proj-実際のAPIキー';
     PropertiesService.getScriptProperties().setProperty('OPENAI_API_KEY', apiKey);
     console.log('APIキー設定完了');
   }
   ```
   - 関数を選択して実行ボタンをクリック

### 2. HTML側の更新

1. **classifyWithAI関数の置き換え**
   - `AI_integration_code_snippet.js`の`classifyWithAI`関数をコピー
   - HTML内の既存の関数を置き換え

2. **カテゴリ定義の更新**
   - 8項目のAI_CATEGORIESをコピーして置き換え

3. **表示関数の更新**
   - `createAIRecordHTML`関数も更新

### 3. デプロイ

1. **新しいデプロイを作成**
   ```
   デプロイ → 新しいデプロイ
   種類: ウェブアプリ
   実行者: 自分
   アクセス: 全員
   ```

2. **URLの取得**
   - デプロイ後のURLでアクセス

### 4. 動作確認

1. **v1モードで記録を追加**
   - 「初めて血圧測定をした」
   - 「糖尿病の合併症を学んだ」
   - 「看護師さんと協力した」

2. **v2モードに切り替え**
   - 「🤖 v2: AI分析」ボタンをクリック

3. **AI分析実行**
   - 「🎯 全レコードAI分析」ボタンをクリック
   - 分類結果が表示されることを確認

## 🔧 トラブルシューティング

### エラー: "google is not defined"
- **原因**: ローカルHTMLファイルで実行している
- **解決**: GAS環境でデプロイしたURLでアクセス

### エラー: "APIキーが設定されていません"
- **原因**: setupOpenAIKey()が未実行
- **解決**: GASエディタで関数を実行

### エラー: "API呼び出しエラー"
- **原因**: APIキーが無効またはクォータ超過
- **解決**: APIキーを確認、OpenAIダッシュボードで状態確認

## 💰 コスト管理

- **モデル**: GPT-4o-mini使用でコスト削減
- **料金目安**: 
  - 入力: $0.15 / 1M トークン
  - 出力: $0.60 / 1M トークン
  - 1記録あたり約0.01円程度

## 🚀 次のステップ

1. **バッチ処理の最適化**
   - 複数記録を1回のAPI呼び出しで処理

2. **キャッシュ機能**
   - 同じテキストの再分類を防ぐ

3. **エクスポート機能**
   - 分類結果をCSV/PDFで出力

4. **詳細分析**
   - カテゴリごとの傾向分析
   - 学習進捗レポート

## 📝 注意事項

- API使用量は定期的に確認
- 個人情報を含む記録は注意
- エラー時のフォールバック処理を確認

---

これで、シンプルな「入力→AI処理→出力」の基本フローが完成します！